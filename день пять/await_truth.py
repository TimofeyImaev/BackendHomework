"""
–ü–†–ê–í–î–ê –û–ë await: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–ï–ó —Å–æ–∑–¥–∞–Ω–∏—è Task

–í—ã –ê–ë–°–û–õ–Æ–¢–ù–û –ü–†–ê–í–´!
await –¥–µ–ª–∞–µ—Ç –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
await –ù–ï —Å–æ–∑–¥–∞–µ—Ç Task.
Future —Å–æ–∑–¥–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò –∫–æ—Ä—É—Ç–∏–Ω, –∞ –Ω–µ await'–æ–º.
"""

import asyncio
import time

# ============================================
# –ü–†–ê–í–î–ê 1: await - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
# ============================================
print("=" * 70)
print("–ü–†–ê–í–î–ê 1: await - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ")
print("=" * 70)
print()

async def slow_task(name, delay):
    print(f"[{time.time():.2f}] {name}: –Ω–∞—á–∞–ª")
    await asyncio.sleep(delay)
    print(f"[{time.time():.2f}] {name}: –∑–∞–≤–µ—Ä—à–∏–ª")
    return name

async def sequential_await():
    """await –¥–µ–ª–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ"""
    print("=== await - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ===")
    start = time.time()
    
    # await –ù–ï —Å–æ–∑–¥–∞–µ—Ç Task!
    # –ö–æ—Ä—É—Ç–∏–Ω—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û
    result1 = await slow_task("task1", 1.0)  # –ñ–¥–µ–º 1 —Å–µ–∫
    result2 = await slow_task("task2", 0.5)  # –ü–æ—Ç–æ–º –µ—â–µ 0.5 —Å–µ–∫
    
    elapsed = time.time() - start
    print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: [{result1}, {result2}]")
    print(f"–í—Ä–µ–º—è: {elapsed:.2f} —Å–µ–∫ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: 1.0 + 0.5 = 1.5)")
    print()

# ============================================
# –ü–†–ê–í–î–ê 2: await –ù–ï —Å–æ–∑–¥–∞–µ—Ç Task
# ============================================
print("=" * 70)
print("–ü–†–ê–í–î–ê 2: await –ù–ï —Å–æ–∑–¥–∞–µ—Ç Task")
print("=" * 70)
print()

task_count = 0
original_create_task = asyncio.create_task

def traced_create_task(coro, name=None):
    global task_count
    task_count += 1
    print(f"üì¶ Task #{task_count} —Å–æ–∑–¥–∞–Ω: {coro}")
    return original_create_task(coro, name=name)

asyncio.create_task = traced_create_task

async def test_await_no_task():
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ await –ù–ï —Å–æ–∑–¥–∞–µ—Ç Task"""
    print("–í—ã–∑—ã–≤–∞–µ–º await slow_task() –¥–≤–∞–∂–¥—ã")
    print("–û–∂–∏–¥–∞–Ω–∏–µ: Task –ù–ï —Å–æ–∑–¥–∞—Å—Ç—Å—è")
    print()
    
    result1 = await slow_task("task1", 0.1)
    result2 = await slow_task("task2", 0.1)
    
    print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: [{result1}, {result2}]")
    print(f"–í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ Task: {task_count}")
    print("‚Üí await –ù–ï —Å–æ–∑–¥–∞–ª –Ω–∏ –æ–¥–Ω–æ–≥–æ Task!")
    print()

print("–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç:")
asyncio.run(test_await_no_task())
print()

# ============================================
# –ü–†–ê–í–î–ê 3: Future —Å–æ–∑–¥–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò –∫–æ—Ä—É—Ç–∏–Ω
# ============================================
print("=" * 70)
print("–ü–†–ê–í–î–ê 3: Future —Å–æ–∑–¥–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò –∫–æ—Ä—É—Ç–∏–Ω")
print("=" * 70)
print()

print("–ö–æ–≥–¥–∞ –º—ã –¥–µ–ª–∞–µ–º: await asyncio.sleep(1)")
print()
print("1. asyncio.sleep(1) –í–ù–£–¢–†–ò —Å–æ–∑–¥–∞–µ—Ç Future")
print("   üìÅ tasks.py: sleep() ‚Üí —Å–æ–∑–¥–∞–µ—Ç Future")
print()
print("2. await –≤—ã–∑—ã–≤–∞–µ—Ç sleep_coro.__await__()")
print("   ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Future (—É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤–Ω—É—Ç—Ä–∏ sleep)")
print()
print("3. Task.__step() –ø–æ–ª—É—á–∞–µ—Ç Future")
print("   ‚Üí –ñ–¥–µ—Ç Future —á–µ—Ä–µ–∑ callback")
print()
print("‚Üí await –ù–ï —Å–æ–∑–¥–∞–µ—Ç Future!")
print("‚Üí Future —Å–æ–∑–¥–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò –∫–æ—Ä—É—Ç–∏–Ω—ã (asyncio.sleep)")
print("‚Üí await –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç Future")
print()

# ============================================
# –ü–†–ê–í–î–ê 4: await –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Future –¥–ª—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏
# ============================================
print("=" * 70)
print("–ü–†–ê–í–î–ê 4: await –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Future –¥–ª—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
print("=" * 70)
print()

print("await —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:")
print()
print("1. await coro() ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç coro.__await__()")
print("2. coro.__await__() ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Future (—Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤–Ω—É—Ç—Ä–∏ coro)")
print("3. Task.__step() ‚Üí –ø–æ–ª—É—á–∞–µ—Ç Future")
print("4. Task.__step() ‚Üí result.add_done_callback(self.__wakeup)")
print("5. Task –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è")
print("6. Event loop –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á")
print("7. –ö–æ–≥–¥–∞ Future –≥–æ—Ç–æ–≤ ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç __wakeup()")
print("8. Task –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è")
print()
print("‚Üí await –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Future –¥–ª—è –ü–†–ò–û–°–¢–ê–ù–û–í–ö–ò")
print("‚Üí –ù–æ Future —Å–æ–∑–¥–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò –∫–æ—Ä—É—Ç–∏–Ω—ã, –Ω–µ await'–æ–º")
print()

# ============================================
# –°–†–ê–í–ù–ï–ù–ò–ï: await vs create_task
# ============================================
print("=" * 70)
print("–°–†–ê–í–ù–ï–ù–ò–ï: await vs create_task")
print("=" * 70)
print()

async def comparison():
    print("=== await - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ ===")
    start = time.time()
    r1 = await slow_task("A", 0.5)
    r2 = await slow_task("B", 0.5)
    elapsed1 = time.time() - start
    print(f"–í—Ä–µ–º—è: {elapsed1:.2f} —Å–µ–∫ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)")
    print()
    
    print("=== create_task - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ ===")
    start = time.time()
    t1 = asyncio.create_task(slow_task("A", 0.5))
    t2 = asyncio.create_task(slow_task("B", 0.5))
    r1 = await t1
    r2 = await t2
    elapsed2 = time.time() - start
    print(f"–í—Ä–µ–º—è: {elapsed2:.2f} —Å–µ–∫ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)")
    print()
    
    print(f"–†–∞–∑–Ω–∏—Ü–∞: {elapsed1 - elapsed2:.2f} —Å–µ–∫")
    print("‚Üí create_task –±—ã—Å—Ç—Ä–µ–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!")

asyncio.run(comparison())
print()

# ============================================
# –í–´–í–û–î
# ============================================
print("=" * 70)
print("–í–´–í–û–î")
print("=" * 70)
print()

print("‚úÖ await –¥–µ–ª–∞–µ—Ç –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ")
print("   - –ö–æ—Ä—É—Ç–∏–Ω—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–Ω–∞ –∑–∞ –¥—Ä—É–≥–æ–π")
print("   - –ù–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞")
print()
print("‚úÖ await –ù–ï —Å–æ–∑–¥–∞–µ—Ç Task")
print("   - Task —Å–æ–∑–¥–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ create_task()")
print("   - await —Å–∞–º –ø–æ —Å–µ–±–µ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç Task")
print()
print("‚úÖ Future —Å–æ–∑–¥–∞–µ—Ç—Å—è –í–ù–£–¢–†–ò –∫–æ—Ä—É—Ç–∏–Ω")
print("   - asyncio.sleep() —Å–æ–∑–¥–∞–µ—Ç Future –≤–Ω—É—Ç—Ä–∏")
print("   - await –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ—Ç Future")
print("   - await –ù–ï —Å–æ–∑–¥–∞–µ—Ç Future")
print()
print("‚úÖ await –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Future –¥–ª—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
print("   - Future –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ")
print("   - Event loop –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏")
print("   - –ù–æ await —Å–∞–º –ø–æ —Å–µ–±–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π")
print()
print("üîë –ö–õ–Æ–ß–ï–í–û–ï –ü–û–ù–ò–ú–ê–ù–ò–ï:")
print("   await = –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ + Future –¥–ª—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏")
print("   create_task = —Å–æ–∑–¥–∞–Ω–∏–µ Task –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è")
print()
print("üìö –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:")
print("   await - –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ")
print("   create_task - –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ")

















