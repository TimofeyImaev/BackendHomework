"""
–ì–î–ï –ù–ê–•–û–î–ò–¢–°–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø await?

–í–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å: await - —ç—Ç–æ –ù–ï —Ñ—É–Ω–∫—Ü–∏—è, –∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è Python!
–û–Ω–∞ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ –±–∞–π—Ç-–∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ __await__().

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö:
1. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä Python (C-–∫–æ–¥) - –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç await –≤ –±–∞–π—Ç-–∫–æ–¥
2. –ú–µ—Ç–æ–¥ __await__() –æ–±—ä–µ–∫—Ç–æ–≤ (Python-–∫–æ–¥) - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç awaitable –∏—Ç–µ—Ä–∞—Ç–æ—Ä
3. Task.__step() (Python-–∫–æ–¥) - —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ—Ä—É—Ç–∏–Ω
"""

import asyncio
import dis
import inspect

# ============================================
# 1. –ö–ê–ö await –ö–û–ú–ü–ò–õ–ò–†–£–ï–¢–°–Ø –í –ë–ê–ô–¢-–ö–û–î
# ============================================

async def example():
    await asyncio.sleep(1)
    return 42

print("=== 1. –ë–∞–π—Ç-–∫–æ–¥ await ===")
print("–ö–æ–≥–¥–∞ –≤—ã –ø–∏—à–µ—Ç–µ: await asyncio.sleep(1)")
print("Python –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç —ç—Ç–æ –≤ –±–∞–π—Ç-–∫–æ–¥:")
print()
dis.dis(example)
print()

# ============================================
# 2. –ú–ï–¢–û–î __await__() - –≠–¢–û –ì–õ–ê–í–ù–û–ï!
# ============================================

print("=== 2. –ú–µ—Ç–æ–¥ __await__() ===")
print("await –æ–±—ä–µ–∫—Ç –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç.__await__()")
print()
print("–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤:")
print("  üìÅ asyncio/futures.py, —Å—Ç—Ä–æ–∫–∞ 284-290")
print()

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ Future.__await__()
print("Future.__await__() –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:")
print("""
def __await__(self):
    if not self.done():
        self._asyncio_future_blocking = True
        yield self  # ‚Üê –≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Task –∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    if not self.done():
        raise RuntimeError("await wasn't used with future")
    return self.result()  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
""")
print()

# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
future = asyncio.Future()
awaitable = future.__await__()
print(f"future.__await__() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {type(awaitable)}")
print(f"–≠—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä: {inspect.isgenerator(awaitable)}")
print()

# ============================================
# 3. TASK.__STEP() - –£–ü–†–ê–í–õ–Ø–ï–¢ –í–´–ü–û–õ–ù–ï–ù–ò–ï–ú
# ============================================

print("=== 3. Task.__step() - —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º ===")
print("–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤:")
print("  üìÅ asyncio/tasks.py, –º–µ—Ç–æ–¥ Task.__step()")
print()
print("Task.__step() –¥–µ–ª–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ:")
print("  1. –í—ã–∑—ã–≤–∞–µ—Ç coro.send(value) –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∫–æ—Ä—É—Ç–∏–Ω—ã")
print("  2. –ï—Å–ª–∏ –∫–æ—Ä—É—Ç–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Future ‚Üí –∂–¥–µ—Ç –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è")
print("  3. –ö–æ–≥–¥–∞ Future –≥–æ—Ç–æ–≤ ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∫–æ—Ä—É—Ç–∏–Ω—É")
print("  4. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ—Ä—É—Ç–∏–Ω—ã")
print()

# ============================================
# 4. –ü–û–õ–ù–´–ô –ü–£–¢–¨ –í–´–ü–û–õ–ù–ï–ù–ò–Ø await
# ============================================

print("=== 4. –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è await ===")
print()
print("–ö–æ–≥–¥–∞ –≤—ã –ø–∏—à–µ—Ç–µ: result = await future")
print()
print("–®–ê–ì 1: Python –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä")
print("  ‚Üí –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç 'await future' –≤ –±–∞–π—Ç-–∫–æ–¥ GET_AWAITABLE")
print("  ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç future.__await__()")
print()
print("–®–ê–ì 2: future.__await__()")
print("  ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π yield'–∏—Ç self (Future)")
print("  ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç _asyncio_future_blocking = True")
print()
print("–®–ê–ì 3: Task.__step()")
print("  ‚Üí –í–∏–¥–∏—Ç, —á—Ç–æ –∫–æ—Ä—É—Ç–∏–Ω–∞ –≤–µ—Ä–Ω—É–ª–∞ Future")
print("  ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç Future –≤ self._fut_waiter")
print("  ‚Üí –î–æ–±–∞–≤–ª—è–µ—Ç callback –Ω–∞ Future")
print("  ‚Üí –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Task")
print()
print("–®–ê–ì 4: Event Loop")
print("  ‚Üí –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏")
print("  ‚Üí –ö–æ–≥–¥–∞ Future –≥–æ—Ç–æ–≤ ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç callback")
print()
print("–®–ê–ì 5: Callback")
print("  ‚Üí –í—ã–∑—ã–≤–∞–µ—Ç Task.__wakeup()")
print("  ‚Üí –ö–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç Task.__step() —Å–Ω–æ–≤–∞")
print("  ‚Üí –ö–æ—Ä—É—Ç–∏–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º Future")
print()

# ============================================
# 5. –ö–û–ù–ö–†–ï–¢–ù–´–ï –§–ê–ô–õ–´ –ò –°–¢–†–û–ö–ò
# ============================================

print("=== 5. –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–¥ ===")
print()
print("üìÅ asyncio/futures.py")
print("   –°—Ç—Ä–æ–∫–∞ 284-290: Future.__await__()")
print("   –≠—Ç–æ –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ await future")
print()
print("üìÅ asyncio/tasks.py")
print("   –ú–µ—Ç–æ–¥ Task.__step() - —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ—Ä—É—Ç–∏–Ω—ã")
print("   –ú–µ—Ç–æ–¥ Task.__wakeup() - –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ await")
print()
print("üìÅ asyncio/base_events.py")
print("   –ú–µ—Ç–æ–¥ BaseEventLoop._run_once() - –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª")
print("   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–µ Task –∏ Future")
print()
print("üìÅ Python C-–∫–æ–¥ (–∏—Å—Ö–æ–¥–Ω–∏–∫–∏ CPython)")
print("   ceval.c - –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –±–∞–π—Ç-–∫–æ–¥–∞")
print("   compile.c - –∫–æ–º–ø–∏–ª—è—Ü–∏—è await –≤ –±–∞–π—Ç-–∫–æ–¥")
print("   (–≠—Ç–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ cpython –Ω–∞ GitHub)")
print()

# ============================================
# 6. –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ê–Ø –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø
# ============================================

print("=== 6. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è ===")

async def demo():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã await"""
    print("  demo: –Ω–∞—á–∞–ª")
    
    # –ö–æ–≥–¥–∞ –º—ã –¥–µ–ª–∞–µ–º await, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
    # 1. asyncio.sleep(1) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—É—Ç–∏–Ω—É
    # 2. –ö–æ—Ä—É—Ç–∏–Ω–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ Task
    # 3. Task.__step() –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ—Ä—É—Ç–∏–Ω—É
    # 4. –ö–æ—Ä—É—Ç–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Future
    # 5. Task –∂–¥–µ—Ç Future
    # 6. Event loop –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    await asyncio.sleep(0.1)
    
    print("  demo: –ø—Ä–æ–¥–æ–ª–∂–∏–ª –ø–æ—Å–ª–µ await")
    return "done"

print("–ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ—Ä—É—Ç–∏–Ω—É:")
print("(–í–Ω—É—Ç—Ä–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–∞–≥–∏—è await —á–µ—Ä–µ–∑ Task.__step())")
asyncio.run(demo())
print()

print("=== –í–´–í–û–î ===")
print("await - —ç—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä!")
print("–†–µ–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤:")
print("  1. __await__() –º–µ—Ç–æ–¥–µ –æ–±—ä–µ–∫—Ç–æ–≤ (Python-–∫–æ–¥)")
print("  2. Task.__step() –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º (Python-–∫–æ–¥)")
print("  3. Event loop –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (Python-–∫–æ–¥)")
print("  4. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä Python –¥–ª—è –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—è –≤ –±–∞–π—Ç-–∫–æ–¥ (C-–∫–æ–¥)")

















